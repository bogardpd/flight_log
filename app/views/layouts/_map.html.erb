<% map_attr = map.gcmap %>

<div class="map-gcmap <%= map_attr[:map_type] %>" id="<%= map_attr[:id] %>">
  <% if local_assigns[:region] %>
    <%= gcmap_region_select_links(map, region, anchor: map_attr[:id]) %>
  <% end %>
  <%= link_to(image_tag(map_attr[:img_path], alt: map_attr[:description], class: "map"), map_attr[:link_path], target: :_blank) %>
  <div class="map-info credit">
    <div>
      Map generated by <%= link_to("Great Circle Mapper", "http://www.gcmap.com/", target: "_blank") %>
    </div>
    <div>
      <%= link_to("GPX", params.permit!.merge(map_id: map_attr[:id], extension: :gpx)) %>
      &middot; 
      <%= link_to("KML", params.permit!.merge(map_id: map_attr[:id], extension: :kml)) %>
    </div>
  </div>
  <% if local_assigns[:distance] %>
    <div class="map-metrics">
      <span class="distance-primary">
        <%= NumberFormat.value(distance[:miles]) %> <%= [distance[:adjective],"mile"].compact.join(" ").pluralize(distance[:miles]) %>
      </span>
      <span class="distance-secondary">
        (<%= NumberFormat.value(Distance::km(distance[:miles])) %> km)
      </span>
      <% if local_assigns[:flight_link] %>
        <% flights_path = flight_link[:path] || "#flights" %>
        &middot;
        <% if flight_link[:total] %>
          <%= link_to(safe_join(["See all", content_tag(:span, pluralize(flight_link[:total], "flight"), class: "summary-total", "data-total": flight_link[:total])], " "), flights_path) %>
        <% else %>
          <%= link_to("See a list of these flights", flights_path) %>
        <% end %>
      <% end %>
    </div>
  <% end %>
</div>