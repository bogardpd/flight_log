<h1>Routes</h1>

<p>I have had commercial flights on <%= pluralize(@route_table.count, 'route') %>.</p>

<% if @route_table.any? %>

<p>Each route listed includes flights going both directions.</p>

<table class="flightlog">
  <tr class="th">
    <th class="counter">#</th>
		<th class="route_route">Route</th>
		<th class="route_distance"><%= sort_link("Distance", :distance, "distance", :desc, nil) %></th>
    <th class="route_flights"><%= sort_link("Flights", :flights, "flights", :desc, nil) %></th>
  </tr>
<% previous_count = nil %>
<% @route_table.each_with_index do |row, index| %>
  <tr>
    <td class="counter">
			<% if @sort_cat == :flights %>
				<%= (@sort_cat == :flights && row[:total_flights] == previous_count) ? "⋮" : index + 1 %>
			<% elsif @sort_cat == :distance %>
				<%= (@sort_cat == :distance && row[:distance_mi] == previous_count) ? "⋮" : index + 1 %>
			<% else %>
				<%= index + 1 %>
			<% end %>
		</td>
		<td class="route_route"><%= link_to("<span class=\"code-mono\">#{row[:route][0]}</span> &#x21C4; <span class=\"code-mono\">#{row[:route][1]}</span>".html_safe, route_path(row[:route].join("-")), :title => "View flights between #{row[:route][0]} and #{row[:route][1]}") %></td>
    <td class="route_distance"><%= render "flights/graph_block_with_unit", :value => row[:distance_mi], :maximum => @distance_maximum, :unit => "mi" %></td>
		<td class="route_flights"><%= render "flights/graph_block", :value => row[:total_flights], :maximum => @flights_maximum %></td>
  </tr>
	<% previous_count = @sort_cat == :flights ? row[:total_flights] : row[:distance_mi] %>
<% end %>
  <tr><td colspan="4" class="flightlog_total"><%= pluralize(@route_table.count, 'route') %></td></tr>
</table>

<% else %>

<%= render 'flights/error_no_flights' %>

<% end %>