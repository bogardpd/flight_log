<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: BoardingPass
  
    &mdash; Documentation by YARD 0.9.19
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "BoardingPass";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index (B)</a> &raquo;
    
    
    <span class="title">BoardingPass</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: BoardingPass
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">BoardingPass</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  <dl>
      <dt>Includes:</dt>
      <dd>ActionView::Helpers::TextHelper</dd>
  </dl>
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>app/classes/boarding_pass.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Defines a Boarding Pass based on
<a href="https://www.iata.org/whatwedo/stb/Documents/BCBP-Implementation-Guide-5th-Edition-June-2016.pdf" target="_parent" title="IATA Bar Coded Boarding Pass (BCBP)">IATA Bar Coded Boarding Pass (BCBP)</a> data. Used to parse boarding pass
barcode text received by email or entered into a form.</p>


  </div>
</div>
<div class="tags">
  

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="BoardingPassEmail.html" title="BoardingPassEmail (module)">BoardingPassEmail</a></span></li>
    
      <li><span class='object_link'><a href="FlightXML.html" title="FlightXML (module)">FlightXML</a></span></li>
    
      <li><a href="https://www.iata.org/whatwedo/stb/Documents/BCBP-Implementation-Guide-5th-Edition-June-2016.pdf" target="_parent" title="IATA Bar Coded Boarding Pass (BCBP) Implementation Guide">IATA Bar Coded Boarding Pass (BCBP) Implementation Guide</a></li>
    
  </ul>

</div>
  
    <h2>
      Constant Summary
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="ERROR-constant" class="">ERROR =
          <div class="docstring">
  <div class="discussion">
    
<p>The default error message to return if a boarding pass parse failed.</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>We were unable to parse the data in the boarding pass barcode.</span><span class='tstring_end'>&quot;</span></span></pre></dd>
      
    </dl>
  







  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#data-instance_method" title="#data (instance method)">#<strong>data</strong>  &#x21d2; Hash{Symbol=&gt;Hash} </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns a hash of barcode fields and data.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#extract_detail-instance_method" title="#extract_detail (instance method)">#<strong>extract_detail</strong>(detail)  &#x21d2; Array </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns an array of a particular detail (:raw, :valid, etc.), in the order
that it would show up in the boarding pass raw data.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#flight_date-instance_method" title="#flight_date (instance method)">#<strong>flight_date</strong>(known_date)  &#x21d2; Date </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the most likely flight date given a known UTC Date.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#form_values-instance_method" title="#form_values (instance method)">#<strong>form_values</strong>(departure_utc_time = nil)  &#x21d2; Hash{Symbol=&gt;String,Date,nil} </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns a hash of form field values extracted from this barcode.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(boarding_pass_data, flight: nil, interpretations: true)  &#x21d2; BoardingPass </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Initialize a boarding pass.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#is_valid%3F-instance_method" title="#is_valid? (instance method)">#<strong>is_valid?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns whether or not the boarding pass data is valid under the IATA BCBP
standard.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#ordered_groups-instance_method" title="#ordered_groups (instance method)">#<strong>ordered_groups</strong>  &#x21d2; Array&lt;Hash&gt;<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Return an array of group titles and fields.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#raw-instance_method" title="#raw (instance method)">#<strong>raw</strong>  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the IATA BCBP barcode.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#summary_fields-instance_method" title="#summary_fields (instance method)">#<strong>summary_fields</strong>  &#x21d2; Hash{Symbol=&gt;String} </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns a hash containing basic flight details.</p>
</div></span>
  
</li>

      
    </ul>
  


  <div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(boarding_pass_data, flight: nil, interpretations: true)  &#x21d2; <tt><span class='object_link'><a href="" title="BoardingPass (class)">BoardingPass</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Initialize a boarding pass.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>boarding_pass_data</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>barcode string in IATA Bar Coded Boarding Pass format (see
<a href="https://www.iata.org/whatwedo/stb/Documents/BCBP-Implementation-Guide-5th-Edition-June-2016.pdf" target="_parent" title="BCBP Implementation Guide">BCBP Implementation Guide</a> Section 4.2)</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>flight</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Flight.html" title="Flight (class)">Flight</a></span></tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>a Flight that this boarding pass is associated with. Used to provide exact
dates rather than an estimate from the BCBP data.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>interpretations</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>whether or not the Boarding Pass should try to provide interpretations of
what the BCBP data means</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/classes/boarding_pass.rb', line 24</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_boarding_pass_data'>boarding_pass_data</span><span class='comma'>,</span> <span class='label'>flight:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>interpretations:</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='ivar'>@raw_data</span> <span class='op'>=</span> <span class='id identifier rubyid_boarding_pass_data'>boarding_pass_data</span>
  <span class='ivar'>@flight</span> <span class='op'>=</span> <span class='id identifier rubyid_flight'>flight</span>
  
  <span class='kw'>begin</span>
    <span class='ivar'>@airline_compartments</span> <span class='op'>=</span> <span class='const'>JSON</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>app/assets/json/airline_compartments.json</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>rescue</span>
    <span class='ivar'>@airline_compartments</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>
  
  <span class='kw'>if</span> <span class='ivar'>@raw_data</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
    <span class='ivar'>@raw_data</span> <span class='op'>=</span> <span class='ivar'>@raw_data</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\\(.)</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>\1</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='comment'># Remove leftover JSON escape characters from barcode data
</span>    <span class='ivar'>@fields</span>  <span class='op'>=</span> <span class='id identifier rubyid_create_fields'>create_fields</span><span class='lparen'>(</span><span class='id identifier rubyid_determine_version'>determine_version</span><span class='lparen'>(</span><span class='ivar'>@raw_data</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='ivar'>@control</span> <span class='op'>=</span> <span class='id identifier rubyid_create_control_points'>create_control_points</span><span class='lparen'>(</span><span class='ivar'>@raw_data</span><span class='rparen'>)</span>
    <span class='ivar'>@structured_data</span> <span class='op'>=</span> <span class='id identifier rubyid_build_structured_data'>build_structured_data</span><span class='lparen'>(</span><span class='ivar'>@control</span><span class='comma'>,</span> <span class='ivar'>@fields</span><span class='comma'>,</span> <span class='id identifier rubyid_interpretations'>interpretations</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="data-instance_method">
  
    #<strong>data</strong>  &#x21d2; <tt>Hash{Symbol=&gt;Hash}</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns a hash of barcode fields and data.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash{Symbol=&gt;Hash}</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>barcode fields and data</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


63
64
65</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/classes/boarding_pass.rb', line 63</span>

<span class='kw'>def</span> <span class='id identifier rubyid_data'>data</span>
  <span class='kw'>return</span> <span class='ivar'>@structured_data</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="extract_detail-instance_method">
  
    #<strong>extract_detail</strong>(detail)  &#x21d2; <tt>Array</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns an array of a particular detail (:raw, :valid, etc.), in the order
that it would show up in the boarding pass raw data.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>detail</span>
      
      
        <span class='type'>(<tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the detail type to look up (:raw, :valid, etc.)</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>all values of the provided detail type.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


137
138
139
140</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/classes/boarding_pass.rb', line 137</span>

<span class='kw'>def</span> <span class='id identifier rubyid_extract_detail'>extract_detail</span><span class='lparen'>(</span><span class='id identifier rubyid_detail'>detail</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='id identifier rubyid_ordered_groups'>ordered_groups</span>
  <span class='id identifier rubyid_ordered_groups'>ordered_groups</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_g'>g</span><span class='op'>|</span> <span class='id identifier rubyid_g'>g</span><span class='lbracket'>[</span><span class='symbol'>:fields</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='id identifier rubyid_detail'>detail</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_flatten'>flatten</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="flight_date-instance_method">
  
    #<strong>flight_date</strong>(known_date)  &#x21d2; <tt>Date</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the most likely flight date given a known UTC Date.</p>

<p>The BCBP standard does not include a year in the barcode data, so we have
to estimate the date by assuming it&#39;s probably in the provided
date&#39;s year, or the previous or next year.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>known_date</span>
      
      
        <span class='type'>(<tt>Date</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>an initial date (UTC) to base the flight date estimate on (usually today,
unless a better date is known)</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Date</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the most likely date (UTC) this barcode&#39;s flight took place</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="https://www.iata.org/whatwedo/stb/Documents/BCBP-Implementation-Guide-5th-Edition-June-2016.pdf" target="_parent" title="IATA Bar Coded Boarding Pass (BCBP) Implementation Guide">IATA Bar Coded Boarding Pass (BCBP) Implementation Guide</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


78
79
80
81
82
83
84
85</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/classes/boarding_pass.rb', line 78</span>

<span class='kw'>def</span> <span class='id identifier rubyid_flight_date'>flight_date</span><span class='lparen'>(</span><span class='id identifier rubyid_known_date'>known_date</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_candidate_years'>candidate_years</span> <span class='op'>=</span> <span class='op'>*</span><span class='lparen'>(</span><span class='id identifier rubyid_known_date'>known_date</span><span class='period'>.</span><span class='id identifier rubyid_year'>year</span><span class='op'>-</span><span class='int'>1</span><span class='op'>..</span><span class='id identifier rubyid_known_date'>known_date</span><span class='period'>.</span><span class='id identifier rubyid_year'>year</span><span class='op'>+</span><span class='int'>1</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_flight_date'>flight_date</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_dig'>dig</span><span class='lparen'>(</span><span class='symbol'>:repeated</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='symbol'>:mandatory</span><span class='comma'>,</span> <span class='int'>46</span><span class='comma'>,</span> <span class='symbol'>:raw</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_candidate_years'>candidate_years</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_y'>y</span><span class='op'>|</span>
    <span class='id identifier rubyid_year_date'>year_date</span> <span class='op'>=</span> <span class='const'>Date</span><span class='period'>.</span><span class='id identifier rubyid_gregorian_leap?'>gregorian_leap?</span><span class='lparen'>(</span><span class='id identifier rubyid_y'>y</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='const'>Date</span><span class='period'>.</span><span class='id identifier rubyid_ordinal'>ordinal</span><span class='lparen'>(</span><span class='id identifier rubyid_y'>y</span><span class='comma'>,</span><span class='id identifier rubyid_flight_date'>flight_date</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='const'>Date</span><span class='period'>.</span><span class='id identifier rubyid_ordinal'>ordinal</span><span class='lparen'>(</span><span class='id identifier rubyid_y'>y</span><span class='comma'>,</span><span class='lbracket'>[</span><span class='int'>365</span><span class='comma'>,</span><span class='id identifier rubyid_flight_date'>flight_date</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_min'>min</span><span class='rparen'>)</span>
    <span class='lbracket'>[</span><span class='id identifier rubyid_year_date'>year_date</span><span class='comma'>,</span> <span class='lparen'>(</span><span class='id identifier rubyid_known_date'>known_date</span> <span class='op'>-</span> <span class='id identifier rubyid_year_date'>year_date</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span><span class='rbracket'>]</span>
   <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_min'>min</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_a'>a</span><span class='comma'>,</span><span class='id identifier rubyid_b'>b</span><span class='op'>|</span> <span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span> <span class='op'>&lt;=&gt;</span> <span class='id identifier rubyid_b'>b</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="form_values-instance_method">
  
    #<strong>form_values</strong>(departure_utc_time = nil)  &#x21d2; <tt>Hash{Symbol=&gt;String,Date,nil}</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns a hash of form field values extracted from this barcode. Used to
prepopulate the New Flight or Edit Flight forms.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>departure_utc_time</span>
      
      
        <span class='type'>(<tt>DateTime</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>the UTC departure date and time for this flight, if known</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash{Symbol=&gt;String,Date,nil}</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>a hash of form field names and values</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/classes/boarding_pass.rb', line 92</span>

<span class='kw'>def</span> <span class='id identifier rubyid_form_values'>form_values</span><span class='lparen'>(</span><span class='id identifier rubyid_departure_utc_time'>departure_utc_time</span><span class='op'>=</span><span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='id identifier rubyid_fields'>fields</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  
  <span class='id identifier rubyid_utc_date'>utc_date</span> <span class='op'>=</span> <span class='id identifier rubyid_departure_utc_time'>departure_utc_time</span> <span class='op'>?</span> <span class='id identifier rubyid_departure_utc_time'>departure_utc_time</span><span class='period'>.</span><span class='id identifier rubyid_to_date'>to_date</span> <span class='op'>:</span> <span class='const'>Date</span><span class='period'>.</span><span class='id identifier rubyid_today'>today</span>
  <span class='id identifier rubyid_departure_date_local'>departure_date_local</span> <span class='op'>=</span> <span class='id identifier rubyid_flight_date'>flight_date</span><span class='lparen'>(</span><span class='id identifier rubyid_utc_date'>utc_date</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_fields'>fields</span><span class='period'>.</span><span class='id identifier rubyid_store'>store</span><span class='lparen'>(</span><span class='symbol'>:departure_date</span><span class='comma'>,</span> <span class='id identifier rubyid_departure_date_local'>departure_date_local</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_origin_airport_iata'>origin_airport_iata</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_dig'>dig</span><span class='lparen'>(</span><span class='symbol'>:repeated</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='symbol'>:mandatory</span><span class='comma'>,</span> <span class='int'>26</span><span class='comma'>,</span> <span class='symbol'>:raw</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_fields'>fields</span><span class='period'>.</span><span class='id identifier rubyid_store'>store</span><span class='lparen'>(</span><span class='symbol'>:origin_airport_iata</span><span class='comma'>,</span> <span class='id identifier rubyid_origin_airport_iata'>origin_airport_iata</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_origin_airport_iata'>origin_airport_iata</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
  
  <span class='id identifier rubyid_destination_airport_iata'>destination_airport_iata</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_dig'>dig</span><span class='lparen'>(</span><span class='symbol'>:repeated</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='symbol'>:mandatory</span><span class='comma'>,</span> <span class='int'>38</span><span class='comma'>,</span> <span class='symbol'>:raw</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_fields'>fields</span><span class='period'>.</span><span class='id identifier rubyid_store'>store</span><span class='lparen'>(</span><span class='symbol'>:destination_airport_iata</span><span class='comma'>,</span> <span class='id identifier rubyid_destination_airport_iata'>destination_airport_iata</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_destination_airport_iata'>destination_airport_iata</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
  
  <span class='id identifier rubyid_airline_iata'>airline_iata</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_dig'>dig</span><span class='lparen'>(</span><span class='symbol'>:repeated</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='symbol'>:mandatory</span><span class='comma'>,</span> <span class='int'>42</span><span class='comma'>,</span> <span class='symbol'>:raw</span><span class='rparen'>)</span><span class='op'>&amp;.</span><span class='id identifier rubyid_strip'>strip</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_airline_iata'>airline_iata</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
    <span class='id identifier rubyid_fields'>fields</span><span class='period'>.</span><span class='id identifier rubyid_store'>store</span><span class='lparen'>(</span><span class='symbol'>:airline_iata</span><span class='comma'>,</span> <span class='id identifier rubyid_airline_iata'>airline_iata</span><span class='rparen'>)</span>
    
    <span class='id identifier rubyid_bp_issuer'>bp_issuer</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_dig'>dig</span><span class='lparen'>(</span><span class='symbol'>:unique</span><span class='comma'>,</span> <span class='symbol'>:conditional</span><span class='comma'>,</span> <span class='int'>21</span><span class='comma'>,</span> <span class='symbol'>:raw</span><span class='rparen'>)</span><span class='op'>&amp;.</span><span class='id identifier rubyid_strip'>strip</span>
    <span class='id identifier rubyid_marketing_carrier'>marketing_carrier</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_dig'>dig</span><span class='lparen'>(</span><span class='symbol'>:repeated</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='symbol'>:conditional</span><span class='comma'>,</span> <span class='int'>19</span><span class='comma'>,</span> <span class='symbol'>:raw</span><span class='rparen'>)</span><span class='op'>&amp;.</span><span class='id identifier rubyid_strip'>strip</span>
    <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_bp_issuer'>bp_issuer</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_airline_iata'>airline_iata</span> <span class='op'>!=</span> <span class='id identifier rubyid_bp_issuer'>bp_issuer</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_fields'>fields</span><span class='period'>.</span><span class='id identifier rubyid_store'>store</span><span class='lparen'>(</span><span class='symbol'>:codeshare_airline_iata</span><span class='comma'>,</span> <span class='id identifier rubyid_bp_issuer'>bp_issuer</span><span class='rparen'>)</span>
    <span class='kw'>elsif</span> <span class='lparen'>(</span><span class='id identifier rubyid_marketing_carrier'>marketing_carrier</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_airline_iata'>airline_iata</span> <span class='op'>!=</span> <span class='id identifier rubyid_marketing_carrier'>marketing_carrier</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_fields'>fields</span><span class='period'>.</span><span class='id identifier rubyid_store'>store</span><span class='lparen'>(</span><span class='symbol'>:codeshare_airline_iata</span><span class='comma'>,</span> <span class='id identifier rubyid_marketing_carrier'>marketing_carrier</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_compartment_code'>compartment_code</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_dig'>dig</span><span class='lparen'>(</span><span class='symbol'>:repeated</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='symbol'>:mandatory</span><span class='comma'>,</span> <span class='int'>71</span><span class='comma'>,</span> <span class='symbol'>:raw</span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_compartment_code'>compartment_code</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
        <span class='id identifier rubyid_travel_class'>travel_class</span> <span class='op'>=</span> <span class='ivar'>@airline_compartments</span><span class='period'>.</span><span class='id identifier rubyid_dig'>dig</span><span class='lparen'>(</span><span class='id identifier rubyid_airline_iata'>airline_iata</span><span class='comma'>,</span> <span class='id identifier rubyid_compartment_code'>compartment_code</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>class</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_fields'>fields</span><span class='period'>.</span><span class='id identifier rubyid_store'>store</span><span class='lparen'>(</span><span class='symbol'>:travel_class</span><span class='comma'>,</span> <span class='id identifier rubyid_travel_class'>travel_class</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='const'><span class='object_link'><a href="TravelClass.html" title="TravelClass (module)">TravelClass</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="TravelClass.html#CLASSES-constant" title="TravelClass::CLASSES (constant)">CLASSES</a></span></span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_travel_class'>travel_class</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>rescue</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>ENOENT</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_flight_number'>flight_number</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_dig'>dig</span><span class='lparen'>(</span><span class='symbol'>:repeated</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='symbol'>:mandatory</span><span class='comma'>,</span> <span class='int'>43</span><span class='comma'>,</span> <span class='symbol'>:raw</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_fields'>fields</span><span class='period'>.</span><span class='id identifier rubyid_store'>store</span><span class='lparen'>(</span><span class='symbol'>:flight_number</span><span class='comma'>,</span> <span class='id identifier rubyid_flight_number'>flight_number</span><span class='op'>&amp;.</span><span class='id identifier rubyid_strip'>strip</span><span class='op'>&amp;.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^0*</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_flight_number'>flight_number</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
  
  <span class='kw'>return</span> <span class='id identifier rubyid_fields'>fields</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="is_valid?-instance_method">
  
    #<strong>is_valid?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns whether or not the boarding pass data is valid under the IATA BCBP
standard.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>false if any fields have valid equal to false or nil, true otherwise</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="https://www.iata.org/whatwedo/stb/Documents/BCBP-Implementation-Guide-5th-Edition-June-2016.pdf" target="_parent" title="IATA Bar Coded Boarding Pass (BCBP) Implementation Guide">IATA Bar Coded Boarding Pass (BCBP) Implementation Guide</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


48
49
50
51</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/classes/boarding_pass.rb', line 48</span>

<span class='kw'>def</span> <span class='id identifier rubyid_is_valid?'>is_valid?</span>
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='ivar'>@raw_data</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_extract_detail'>extract_detail</span><span class='lparen'>(</span><span class='symbol'>:valid</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_reduce'>reduce</span><span class='lparen'>(</span><span class='symbol'>:&amp;</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="ordered_groups-instance_method">
  
    #<strong>ordered_groups</strong>  &#x21d2; <tt>Array&lt;Hash&gt;</tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Return an array of group titles and fields.</p>

<p>Groups can be one of the following, from the IATA BCBP standard:</p>
<ul><li>
<p>:um (unique mandatory)</p>
</li><li>
<p>:rm (repeated mandatory, for specified leg)</p>
</li><li>
<p>:uc (unique conditional)</p>
</li><li>
<p>:rc (repeated conditional, for specified leg)</p>
</li><li>
<p>:ra (repeated airline use, for specified leg)</p>
</li><li>
<p>:security (unique security)</p>
</li><li>
<p>:unknown (any fields not recognized)</p>
</li></ul>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;Hash&gt;</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>An array of hashes, each containing group titles and fields.</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="https://www.iata.org/whatwedo/stb/Documents/BCBP-Implementation-Guide-5th-Edition-June-2016.pdf" target="_parent" title="IATA Bar Coded Boarding Pass (BCBP) Implementation Guide">IATA Bar Coded Boarding Pass (BCBP) Implementation Guide</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/classes/boarding_pass.rb', line 156</span>

<span class='kw'>def</span> <span class='id identifier rubyid_ordered_groups'>ordered_groups</span>
  <span class='id identifier rubyid_output'>output</span> <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_set_group'>set_group</span> <span class='op'>=</span> <span class='id identifier rubyid_proc'>proc</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_title'>title</span><span class='comma'>,</span> <span class='id identifier rubyid_fields'>fields</span><span class='op'>|</span>
    <span class='id identifier rubyid_output'>output</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='label'>title:</span> <span class='id identifier rubyid_title'>title</span><span class='comma'>,</span> <span class='label'>fields:</span> <span class='id identifier rubyid_fields'>fields</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='rbrace'>}</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='ivar'>@control</span>
  <span class='kw'>if</span> <span class='ivar'>@control</span><span class='lbracket'>[</span><span class='symbol'>:um</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_set_group'>set_group</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unique Mandatory</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='ivar'>@structured_data</span><span class='period'>.</span><span class='id identifier rubyid_dig'>dig</span><span class='lparen'>(</span><span class='symbol'>:unique</span><span class='comma'>,</span> <span class='symbol'>:mandatory</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='ivar'>@control</span><span class='period'>.</span><span class='id identifier rubyid_dig'>dig</span><span class='lparen'>(</span><span class='symbol'>:rm</span><span class='comma'>,</span> <span class='int'>0</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_set_group'>set_group</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Repeated Mandatory (Leg 1)</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='ivar'>@structured_data</span><span class='period'>.</span><span class='id identifier rubyid_dig'>dig</span><span class='lparen'>(</span><span class='symbol'>:repeated</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='symbol'>:mandatory</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='ivar'>@control</span><span class='lbracket'>[</span><span class='symbol'>:uc</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_set_group'>set_group</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unique Conditional</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='ivar'>@structured_data</span><span class='period'>.</span><span class='id identifier rubyid_dig'>dig</span><span class='lparen'>(</span><span class='symbol'>:unique</span><span class='comma'>,</span> <span class='symbol'>:conditional</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='ivar'>@control</span><span class='period'>.</span><span class='id identifier rubyid_dig'>dig</span><span class='lparen'>(</span><span class='symbol'>:rc</span><span class='comma'>,</span> <span class='int'>0</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_set_group'>set_group</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Repeated Conditional (Leg 1)</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='ivar'>@structured_data</span><span class='period'>.</span><span class='id identifier rubyid_dig'>dig</span><span class='lparen'>(</span><span class='symbol'>:repeated</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='symbol'>:conditional</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='ivar'>@control</span><span class='period'>.</span><span class='id identifier rubyid_dig'>dig</span><span class='lparen'>(</span><span class='symbol'>:ra</span><span class='comma'>,</span> <span class='int'>0</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_set_group'>set_group</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Repeated Airline Use (Leg 1)</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='ivar'>@structured_data</span><span class='period'>.</span><span class='id identifier rubyid_dig'>dig</span><span class='lparen'>(</span><span class='symbol'>:repeated</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='symbol'>:airline</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='ivar'>@control</span><span class='lbracket'>[</span><span class='symbol'>:legs</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@control</span><span class='lbracket'>[</span><span class='symbol'>:legs</span><span class='rbracket'>]</span> <span class='op'>&gt;</span> <span class='int'>1</span>
    <span class='lparen'>(</span><span class='int'>1</span><span class='op'>..</span><span class='ivar'>@control</span><span class='lbracket'>[</span><span class='symbol'>:legs</span><span class='rbracket'>]</span><span class='op'>-</span><span class='int'>1</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_leg'>leg</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='ivar'>@control</span><span class='period'>.</span><span class='id identifier rubyid_dig'>dig</span><span class='lparen'>(</span><span class='symbol'>:rm</span><span class='comma'>,</span> <span class='id identifier rubyid_leg'>leg</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_set_group'>set_group</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Repeated Mandatory (Leg </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_leg'>leg</span><span class='op'>+</span><span class='int'>1</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='ivar'>@structured_data</span><span class='period'>.</span><span class='id identifier rubyid_dig'>dig</span><span class='lparen'>(</span><span class='symbol'>:repeated</span><span class='comma'>,</span> <span class='id identifier rubyid_leg'>leg</span><span class='comma'>,</span> <span class='symbol'>:mandatory</span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
      <span class='kw'>if</span> <span class='ivar'>@control</span><span class='period'>.</span><span class='id identifier rubyid_dig'>dig</span><span class='lparen'>(</span><span class='symbol'>:rc</span><span class='comma'>,</span> <span class='id identifier rubyid_leg'>leg</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_set_group'>set_group</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Repeated Conditional (Leg </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_leg'>leg</span><span class='op'>+</span><span class='int'>1</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='ivar'>@structured_data</span><span class='period'>.</span><span class='id identifier rubyid_dig'>dig</span><span class='lparen'>(</span><span class='symbol'>:repeated</span><span class='comma'>,</span> <span class='id identifier rubyid_leg'>leg</span><span class='comma'>,</span> <span class='symbol'>:conditional</span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
      <span class='kw'>if</span> <span class='ivar'>@control</span><span class='period'>.</span><span class='id identifier rubyid_dig'>dig</span><span class='lparen'>(</span><span class='symbol'>:ra</span><span class='comma'>,</span> <span class='id identifier rubyid_leg'>leg</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_set_group'>set_group</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Repeated Airline Use (Leg </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_leg'>leg</span><span class='op'>+</span><span class='int'>1</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='ivar'>@structured_data</span><span class='period'>.</span><span class='id identifier rubyid_dig'>dig</span><span class='lparen'>(</span><span class='symbol'>:repeated</span><span class='comma'>,</span> <span class='id identifier rubyid_leg'>leg</span><span class='comma'>,</span> <span class='symbol'>:airline</span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='ivar'>@control</span><span class='lbracket'>[</span><span class='symbol'>:security</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_set_group'>set_group</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Security</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='ivar'>@structured_data</span><span class='period'>.</span><span class='id identifier rubyid_dig'>dig</span><span class='lparen'>(</span><span class='symbol'>:unique</span><span class='comma'>,</span> <span class='symbol'>:security</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='ivar'>@control</span><span class='lbracket'>[</span><span class='symbol'>:unknown</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_set_group'>set_group</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unknown</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='ivar'>@structured_data</span><span class='lbracket'>[</span><span class='symbol'>:unknown</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  
  <span class='comment'># Check that raw data presence and order in output matches raw input
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_output'>output</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_g'>g</span><span class='op'>|</span> <span class='id identifier rubyid_g'>g</span><span class='lbracket'>[</span><span class='symbol'>:fields</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='symbol'>:raw</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span> <span class='op'>==</span> <span class='ivar'>@raw_data</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_output'>output</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raw_output'>raw_output</span> <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='id identifier rubyid_raw_output'>raw_output</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='label'>title:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Raw Data</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>fields:</span> <span class='lbrace'>{</span><span class='int'>0</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span><span class='label'>description:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Raw</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>raw:</span> <span class='ivar'>@raw_data</span><span class='comma'>,</span> <span class='label'>interpretation:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Something went wrong and we couldn’t parse this data.</span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span><span class='rbrace'>}</span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_raw_output'>raw_output</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="raw-instance_method">
  
    #<strong>raw</strong>  &#x21d2; <tt>String</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the IATA BCBP barcode.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>IATA BCBP-formatted barcode data</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


56
57
58</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/classes/boarding_pass.rb', line 56</span>

<span class='kw'>def</span> <span class='id identifier rubyid_raw'>raw</span>
  <span class='kw'>return</span> <span class='ivar'>@raw_data</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="summary_fields-instance_method">
  
    #<strong>summary_fields</strong>  &#x21d2; <tt>Hash{Symbol=&gt;String}</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns a hash containing basic flight details.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash{Symbol=&gt;String}</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>a hash containing the Passenger Name Record (PNR) number, airline IATA
code, flight number, origin airport IATA code, and destination airport IATA
code</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


210
211
212
213
214
215
216
217
218
219</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/classes/boarding_pass.rb', line 210</span>

<span class='kw'>def</span> <span class='id identifier rubyid_summary_fields'>summary_fields</span>
  <span class='id identifier rubyid_output'>output</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_output'>output</span><span class='period'>.</span><span class='id identifier rubyid_store'>store</span><span class='lparen'>(</span><span class='symbol'>:pnr</span><span class='comma'>,</span>     <span class='ivar'>@structured_data</span><span class='period'>.</span><span class='id identifier rubyid_dig'>dig</span><span class='lparen'>(</span><span class='symbol'>:repeated</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='symbol'>:mandatory</span><span class='comma'>,</span>  <span class='int'>7</span><span class='comma'>,</span> <span class='symbol'>:raw</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_output'>output</span><span class='period'>.</span><span class='id identifier rubyid_store'>store</span><span class='lparen'>(</span><span class='symbol'>:airline</span><span class='comma'>,</span> <span class='ivar'>@structured_data</span><span class='period'>.</span><span class='id identifier rubyid_dig'>dig</span><span class='lparen'>(</span><span class='symbol'>:repeated</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='symbol'>:mandatory</span><span class='comma'>,</span> <span class='int'>42</span><span class='comma'>,</span> <span class='symbol'>:raw</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_output'>output</span><span class='period'>.</span><span class='id identifier rubyid_store'>store</span><span class='lparen'>(</span><span class='symbol'>:flight</span><span class='comma'>,</span>  <span class='ivar'>@structured_data</span><span class='period'>.</span><span class='id identifier rubyid_dig'>dig</span><span class='lparen'>(</span><span class='symbol'>:repeated</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='symbol'>:mandatory</span><span class='comma'>,</span> <span class='int'>43</span><span class='comma'>,</span> <span class='symbol'>:raw</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_output'>output</span><span class='period'>.</span><span class='id identifier rubyid_store'>store</span><span class='lparen'>(</span><span class='symbol'>:from</span><span class='comma'>,</span>    <span class='ivar'>@structured_data</span><span class='period'>.</span><span class='id identifier rubyid_dig'>dig</span><span class='lparen'>(</span><span class='symbol'>:repeated</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='symbol'>:mandatory</span><span class='comma'>,</span> <span class='int'>26</span><span class='comma'>,</span> <span class='symbol'>:raw</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_output'>output</span><span class='period'>.</span><span class='id identifier rubyid_store'>store</span><span class='lparen'>(</span><span class='symbol'>:to</span><span class='comma'>,</span>      <span class='ivar'>@structured_data</span><span class='period'>.</span><span class='id identifier rubyid_dig'>dig</span><span class='lparen'>(</span><span class='symbol'>:repeated</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='symbol'>:mandatory</span><span class='comma'>,</span> <span class='int'>38</span><span class='comma'>,</span> <span class='symbol'>:raw</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_output'>output</span><span class='period'>.</span><span class='id identifier rubyid_inject'>inject</span><span class='lparen'>(</span><span class='id identifier rubyid_output'>output</span><span class='rparen'>)</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_h'>h</span><span class='comma'>,</span><span class='lparen'>(</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span><span class='id identifier rubyid_v'>v</span><span class='rparen'>)</span><span class='op'>|</span> <span class='id identifier rubyid_h'>h</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_v'>v</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>?</span> <span class='kw'>nil</span> <span class='op'>:</span> <span class='id identifier rubyid_v'>v</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span><span class='semicolon'>;</span> <span class='id identifier rubyid_h'>h</span><span class='rbrace'>}</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_output'>output</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Wed Sep 25 17:07:09 2019 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.19 (ruby-2.3.1).
</div>

    </div>
  </body>
</html>