<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: Route
  
    &mdash; Documentation by YARD 0.9.19
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "Route";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index (R)</a> &raquo;
    
    
    <span class="title">Route</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: Route
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName"><span class='object_link'><a href="ApplicationRecord.html" title="ApplicationRecord (class)">ApplicationRecord</a></span></span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">ActiveRecord::Base</li>
          
            <li class="next"><span class='object_link'><a href="ApplicationRecord.html" title="ApplicationRecord (class)">ApplicationRecord</a></span></li>
          
            <li class="next">Route</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>app/models/route.rb</dd>
  </dl>
  
</div>


  
    <h2>
      Constant Summary
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="ARROW_ONE_WAY_PLAINTEXT-constant" class="">ARROW_ONE_WAY_PLAINTEXT =
          
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>⇒</span><span class='tstring_end'>&quot;</span></span></pre></dd>
      
        <dt id="ARROW_TWO_WAY_PLAINTEXT-constant" class="">ARROW_TWO_WAY_PLAINTEXT =
          
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>⇔</span><span class='tstring_end'>&quot;</span></span></pre></dd>
      
        <dt id="ARROW_ONE_WAY_HTML-constant" class="">ARROW_ONE_WAY_HTML =
          
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>%Q(</span><span class='tstring_content'>&lt;span class=&quot;route-arrow&quot;&gt;</span><span class='embexpr_beg'>#{</span><span class='const'><span class='object_link'><a href="#ARROW_ONE_WAY_PLAINTEXT-constant" title="Route::ARROW_ONE_WAY_PLAINTEXT (constant)">ARROW_ONE_WAY_PLAINTEXT</a></span></span><span class='embexpr_end'>}</span><span class='tstring_content'>&lt;/span&gt;</span><span class='tstring_end'>)</span></span><span class='period'>.</span><span class='id identifier rubyid_html_safe'>html_safe</span></pre></dd>
      
        <dt id="ARROW_TWO_WAY_HTML-constant" class="">ARROW_TWO_WAY_HTML =
          
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>%Q(</span><span class='tstring_content'>&lt;span class=&quot;route-arrow&quot;&gt;</span><span class='embexpr_beg'>#{</span><span class='const'><span class='object_link'><a href="#ARROW_TWO_WAY_PLAINTEXT-constant" title="Route::ARROW_TWO_WAY_PLAINTEXT (constant)">ARROW_TWO_WAY_PLAINTEXT</a></span></span><span class='embexpr_end'>}</span><span class='tstring_content'>&lt;/span&gt;</span><span class='tstring_end'>)</span></span><span class='period'>.</span><span class='id identifier rubyid_html_safe'>html_safe</span></pre></dd>
      
    </dl>
  







  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#distance_by_airport-class_method" title="distance_by_airport (class method)">.<strong>distance_by_airport</strong>(airport_1, airport_2)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Given two airports, returns the distance in statute miles between them.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#distance_by_coordinates-class_method" title="distance_by_coordinates (class method)">.<strong>distance_by_coordinates</strong>(coord_orig, coord_dest)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Accepts two coordinates (floating point [latitude,longitude] arrays), and
returns the great circle distance between them (in integer miles) using the
haversine fomula.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#distance_by_iata-class_method" title="distance_by_iata (class method)">.<strong>distance_by_iata</strong>(iata1, iata2)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Given two IATA airport codes, returns the distance in statute miles between
them.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#flight_count-class_method" title="flight_count (class method)">.<strong>flight_count</strong>(flights)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns an array of hashes.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#total_distance-class_method" title="total_distance (class method)">.<strong>total_distance</strong>(flights)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Given a collection of Flights, returns their total distance.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  

  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="distance_by_airport-class_method">
  
    .<strong>distance_by_airport</strong>(airport_1, airport_2)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Given two airports, returns the distance in statute miles between them.
This calls an SQL query, and should not be used in a loop.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/route.rb', line 27</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_distance_by_airport'>distance_by_airport</span><span class='lparen'>(</span><span class='id identifier rubyid_airport_1'>airport_1</span><span class='comma'>,</span> <span class='id identifier rubyid_airport_2'>airport_2</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_current_route'>current_route</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="" title="Route (class)">Route</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>(airport1_id = ? AND airport2_id = ?) OR (airport1_id = ? AND airport2_id = ?)</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_airport_1'>airport_1</span><span class='comma'>,</span> <span class='id identifier rubyid_airport_2'>airport_2</span><span class='comma'>,</span> <span class='id identifier rubyid_airport_2'>airport_2</span><span class='comma'>,</span> <span class='id identifier rubyid_airport_1'>airport_1</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_current_route'>current_route</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_current_route'>current_route</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_distance_mi'>distance_mi</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_coordinates_1'>coordinates_1</span> <span class='op'>=</span> <span class='id identifier rubyid_airport_1'>airport_1</span><span class='period'>.</span><span class='id identifier rubyid_coordinates'>coordinates</span>
    <span class='id identifier rubyid_coordinates_2'>coordinates_2</span> <span class='op'>=</span> <span class='id identifier rubyid_airport_2'>airport_2</span><span class='period'>.</span><span class='id identifier rubyid_coordinates'>coordinates</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>unless</span> <span class='id identifier rubyid_coordinates_1'>coordinates_1</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_coordinates_2'>coordinates_2</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
    
    <span class='id identifier rubyid_distance'>distance</span> <span class='op'>=</span> <span class='id identifier rubyid_distance_by_coordinates'>distance_by_coordinates</span><span class='lparen'>(</span><span class='id identifier rubyid_coordinates_1'>coordinates_1</span><span class='comma'>,</span> <span class='id identifier rubyid_coordinates_2'>coordinates_2</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>unless</span> <span class='id identifier rubyid_distance'>distance</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
    
    <span class='comment'># Try to save new route:
</span>    <span class='id identifier rubyid_new_route'>new_route</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="" title="Route (class)">Route</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='id identifier rubyid_airport_ids'>airport_ids</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_airport_1'>airport_1</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_airport_2'>airport_2</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_sort'>sort</span>
    <span class='id identifier rubyid_new_route'>new_route</span><span class='period'>.</span><span class='id identifier rubyid_airport1_id'>airport1_id</span> <span class='op'>=</span> <span class='id identifier rubyid_airport_ids'>airport_ids</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
    <span class='id identifier rubyid_new_route'>new_route</span><span class='period'>.</span><span class='id identifier rubyid_airport2_id'>airport2_id</span> <span class='op'>=</span> <span class='id identifier rubyid_airport_ids'>airport_ids</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span>
    <span class='id identifier rubyid_new_route'>new_route</span><span class='period'>.</span><span class='id identifier rubyid_distance_mi'>distance_mi</span> <span class='op'>=</span> <span class='id identifier rubyid_distance'>distance</span>
    <span class='id identifier rubyid_new_route'>new_route</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>      
    
    <span class='kw'>return</span> <span class='id identifier rubyid_distance'>distance</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="distance_by_coordinates-class_method">
  
    .<strong>distance_by_coordinates</strong>(coord_orig, coord_dest)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Accepts two coordinates (floating point [latitude,longitude] arrays), and
returns the great circle distance between them (in integer miles) using the
haversine fomula.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


54
55
56
57
58
59
60
61
62
63
64
65
66
67</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/route.rb', line 54</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_distance_by_coordinates'>distance_by_coordinates</span><span class='lparen'>(</span><span class='id identifier rubyid_coord_orig'>coord_orig</span><span class='comma'>,</span> <span class='id identifier rubyid_coord_dest'>coord_dest</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='id identifier rubyid_coord_orig'>coord_orig</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_coord_dest'>coord_dest</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
  <span class='id identifier rubyid_deg_to_rad'>deg_to_rad</span> <span class='op'>=</span> <span class='const'>Math</span><span class='op'>::</span><span class='const'>PI</span> <span class='op'>/</span> <span class='int'>180</span>
  <span class='id identifier rubyid_radius'>radius</span> <span class='op'>=</span> <span class='float'>3958.7613</span> <span class='comment'># mean radius (miles)
</span>  <span class='id identifier rubyid_phi_1'>phi_1</span> <span class='op'>=</span> <span class='id identifier rubyid_coord_orig'>coord_orig</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>*</span> <span class='id identifier rubyid_deg_to_rad'>deg_to_rad</span>
  <span class='id identifier rubyid_phi_2'>phi_2</span> <span class='op'>=</span> <span class='id identifier rubyid_coord_dest'>coord_dest</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>*</span> <span class='id identifier rubyid_deg_to_rad'>deg_to_rad</span>
  <span class='id identifier rubyid_delta_phi'>delta_phi</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_coord_dest'>coord_dest</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='op'>-</span><span class='id identifier rubyid_coord_orig'>coord_orig</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='op'>*</span> <span class='id identifier rubyid_deg_to_rad'>deg_to_rad</span>
  <span class='id identifier rubyid_delta_lambda'>delta_lambda</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_coord_dest'>coord_dest</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='op'>-</span><span class='id identifier rubyid_coord_orig'>coord_orig</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='op'>*</span> <span class='id identifier rubyid_deg_to_rad'>deg_to_rad</span>
  
  <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_sin'>sin</span><span class='lparen'>(</span><span class='id identifier rubyid_delta_phi'>delta_phi</span><span class='op'>/</span><span class='int'>2</span><span class='rparen'>)</span><span class='op'>**</span><span class='int'>2</span> <span class='op'>+</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_cos'>cos</span><span class='lparen'>(</span><span class='id identifier rubyid_phi_1'>phi_1</span><span class='rparen'>)</span> <span class='op'>*</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_cos'>cos</span><span class='lparen'>(</span><span class='id identifier rubyid_phi_2'>phi_2</span><span class='rparen'>)</span> <span class='op'>*</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_sin'>sin</span><span class='lparen'>(</span><span class='id identifier rubyid_delta_lambda'>delta_lambda</span><span class='op'>/</span><span class='int'>2</span><span class='rparen'>)</span><span class='op'>**</span><span class='int'>2</span>
  <span class='id identifier rubyid_distance'>distance</span> <span class='op'>=</span> <span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_radius'>radius</span> <span class='op'>*</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_atan2'>atan2</span><span class='lparen'>(</span><span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_sqrt'>sqrt</span><span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='const'>Math</span><span class='period'>.</span><span class='id identifier rubyid_sqrt'>sqrt</span><span class='lparen'>(</span><span class='int'>1</span><span class='op'>-</span><span class='id identifier rubyid_a'>a</span><span class='rparen'>)</span><span class='rparen'>)</span>
  
  <span class='kw'>return</span> <span class='id identifier rubyid_distance'>distance</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="distance_by_iata-class_method">
  
    .<strong>distance_by_iata</strong>(iata1, iata2)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Given two IATA airport codes, returns the distance in statute miles between
them. This calls an SQL query, and should not be used in a loop.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


12
13
14
15
16
17
18
19
20
21
22
23</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/route.rb', line 12</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_distance_by_iata'>distance_by_iata</span><span class='lparen'>(</span><span class='id identifier rubyid_iata1'>iata1</span><span class='comma'>,</span> <span class='id identifier rubyid_iata2'>iata2</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_airport_ids'>airport_ids</span> <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_airport_ids'>airport_ids</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Airport.html" title="Airport (class)">Airport</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:iata_code</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_iata1'>iata1</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_try'>try</span><span class='lparen'>(</span><span class='symbol'>:id</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_airport_ids'>airport_ids</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Airport.html" title="Airport (class)">Airport</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:iata_code</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_iata2'>iata2</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_try'>try</span><span class='lparen'>(</span><span class='symbol'>:id</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_current_route'>current_route</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="" title="Route (class)">Route</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>(airport1_id = ? AND airport2_id = ?) OR (airport1_id = ? AND airport2_id = ?)</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_airport_ids'>airport_ids</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_airport_ids'>airport_ids</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_airport_ids'>airport_ids</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_airport_ids'>airport_ids</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_current_route'>current_route</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_current_route'>current_route</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_distance_mi'>distance_mi</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_distance'>distance</span> <span class='op'>=</span> <span class='id identifier rubyid_distance_by_airport'>distance_by_airport</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Airport.html" title="Airport (class)">Airport</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_airport_ids'>airport_ids</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Airport.html" title="Airport (class)">Airport</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_airport_ids'>airport_ids</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_distance'>distance</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span> <span class='op'>?</span> <span class='id identifier rubyid_distance'>distance</span> <span class='op'>:</span> <span class='kw'>false</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="flight_count-class_method">
  
    .<strong>flight_count</strong>(flights)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns an array of hashes. Each hash contains an array of two airport
codes (sorted alphabetically), distance, and number of times flown, sorted
by number of times flown descending. Routes which have been flown but have
not had a distance defined have a value of -1 (to allow sorting).</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/route.rb', line 73</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_flight_count'>flight_count</span><span class='lparen'>(</span><span class='id identifier rubyid_flights'>flights</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_flights'>flights</span> <span class='op'>=</span> <span class='id identifier rubyid_flights'>flights</span><span class='period'>.</span><span class='id identifier rubyid_includes'>includes</span><span class='lparen'>(</span><span class='symbol'>:origin_airport</span><span class='comma'>,</span> <span class='symbol'>:destination_airport</span><span class='rparen'>)</span>
  
  <span class='id identifier rubyid_route_distances'>route_distances</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_route_frequencies'>route_frequencies</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_route_array'>route_array</span> <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='rparen'>)</span>
  
  <span class='const'><span class='object_link'><a href="" title="Route (class)">Route</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find_by_sql'>find_by_sql</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT routes.distance_mi, airports1.iata_code AS iata1, airports2.iata_code AS iata2 FROM routes JOIN airports AS airports1 ON airports1.id = routes.airport1_id JOIN airports AS airports2 ON airports2.id = routes.airport2_id</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='id identifier rubyid_route_distances'>route_distances</span><span class='lbracket'>[</span><span class='lbracket'>[</span><span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_iata1'>iata1</span><span class='comma'>,</span><span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_iata2'>iata2</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_sort'>sort</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_distance_mi'>distance_mi</span> <span class='rbrace'>}</span>
      
  <span class='id identifier rubyid_flights'>flights</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_flight'>flight</span><span class='op'>|</span>
    <span class='id identifier rubyid_airport_alphabetize'>airport_alphabetize</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_flight'>flight</span><span class='period'>.</span><span class='id identifier rubyid_origin_airport'>origin_airport</span><span class='period'>.</span><span class='id identifier rubyid_iata_code'>iata_code</span><span class='comma'>,</span><span class='id identifier rubyid_flight'>flight</span><span class='period'>.</span><span class='id identifier rubyid_destination_airport'>destination_airport</span><span class='period'>.</span><span class='id identifier rubyid_iata_code'>iata_code</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_sort'>sort</span>
    <span class='id identifier rubyid_route_frequencies'>route_frequencies</span><span class='lbracket'>[</span><span class='id identifier rubyid_airport_alphabetize'>airport_alphabetize</span><span class='rbracket'>]</span> <span class='op'>+=</span> <span class='int'>1</span><span class='semicolon'>;</span>
  <span class='kw'>end</span>
  
  <span class='id identifier rubyid_route_frequencies'>route_frequencies</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_route'>route</span><span class='comma'>,</span> <span class='id identifier rubyid_freq'>freq</span><span class='op'>|</span>
    <span class='id identifier rubyid_route_array'>route_array</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='lbrace'>{</span>
      <span class='label'>route:</span> <span class='id identifier rubyid_route'>route</span><span class='comma'>,</span>
      <span class='label'>flight_count:</span> <span class='id identifier rubyid_freq'>freq</span><span class='comma'>,</span>
      <span class='label'>distance_mi:</span> <span class='id identifier rubyid_route_distances'>route_distances</span><span class='lbracket'>[</span><span class='id identifier rubyid_route'>route</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_distance_by_iata'>distance_by_iata</span><span class='lparen'>(</span><span class='id identifier rubyid_route'>route</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='comma'>,</span> <span class='id identifier rubyid_route'>route</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
    <span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  
  <span class='kw'>return</span> <span class='id identifier rubyid_route_array'>route_array</span><span class='period'>.</span><span class='id identifier rubyid_sort_by'>sort_by</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_r'>r</span><span class='op'>|</span> <span class='lbracket'>[</span><span class='op'>-</span><span class='id identifier rubyid_r'>r</span><span class='lbracket'>[</span><span class='symbol'>:flight_count</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_r'>r</span><span class='lbracket'>[</span><span class='symbol'>:route</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_r'>r</span><span class='lbracket'>[</span><span class='symbol'>:route</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
  
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="total_distance-class_method">
  
    .<strong>total_distance</strong>(flights)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Given a collection of Flights, returns their total distance.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


100
101
102</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/models/route.rb', line 100</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_total_distance'>total_distance</span><span class='lparen'>(</span><span class='id identifier rubyid_flights'>flights</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_flight_count'>flight_count</span><span class='lparen'>(</span><span class='id identifier rubyid_flights'>flights</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_reduce'>reduce</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_sum'>sum</span><span class='comma'>,</span> <span class='id identifier rubyid_r'>r</span><span class='op'>|</span> <span class='id identifier rubyid_sum'>sum</span> <span class='op'>+</span> <span class='id identifier rubyid_r'>r</span><span class='lbracket'>[</span><span class='symbol'>:flight_count</span><span class='rbracket'>]</span> <span class='op'>*</span> <span class='id identifier rubyid_r'>r</span><span class='lbracket'>[</span><span class='symbol'>:distance_mi</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Sun May 19 16:53:32 2019 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.19 (ruby-2.3.1).
</div>

    </div>
  </body>
</html>