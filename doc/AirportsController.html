<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: AirportsController
  
    &mdash; Documentation by YARD 0.9.19
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "AirportsController";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index (A)</a> &raquo;
    
    
    <span class="title">AirportsController</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: AirportsController
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName"><span class='object_link'><a href="ApplicationController.html" title="ApplicationController (class)">ApplicationController</a></span></span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">ActionController::Base</li>
          
            <li class="next"><span class='object_link'><a href="ApplicationController.html" title="ApplicationController (class)">ApplicationController</a></span></li>
          
            <li class="next">AirportsController</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>app/controllers/airports_controller.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Controls <span class='object_link'><a href="Airport.html" title="Airport (class)">Airport</a></span> pages and actions.</p>


  </div>
</div>
<div class="tags">
  

</div>






  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create-instance_method" title="#create (instance method)">#<strong>create</strong>  &#x21d2; nil </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Creates a new <span class='object_link'><a href="Airport.html" title="Airport (class)">Airport</a></span>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#destroy-instance_method" title="#destroy (instance method)">#<strong>destroy</strong>  &#x21d2; nil </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Deletes an existing <span class='object_link'><a href="Airport.html" title="Airport (class)">Airport</a></span>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#edit-instance_method" title="#edit (instance method)">#<strong>edit</strong>  &#x21d2; nil </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Shows a form to edit an existing <span class='object_link'><a href="Airport.html" title="Airport (class)">Airport</a></span>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#index-instance_method" title="#index (instance method)">#<strong>index</strong>  &#x21d2; nil </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Shows a table of all <span class='object_link'><a href="Airport.html" title="Airport (class)">Airports</a></span> visited.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#new-instance_method" title="#new (instance method)">#<strong>new</strong>  &#x21d2; nil </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Shows a form to add an <span class='object_link'><a href="Airport.html" title="Airport (class)">Airport</a></span>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#show-instance_method" title="#show (instance method)">#<strong>show</strong>  &#x21d2; nil </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Shows details for a particular <span class='object_link'><a href="Airport.html" title="Airport (class)">Airport</a></span> and data for all <span class='object_link'><a href="Flight.html" title="Flight (class)">Flights</a></span>
which use it.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update-instance_method" title="#update (instance method)">#<strong>update</strong>  &#x21d2; nil </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Updates an existing <span class='object_link'><a href="Airport.html" title="Airport (class)">Airport</a></span>.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="ApplicationController.html" title="ApplicationController (class)">ApplicationController</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="ApplicationController.html#check_email_for_boarding_passes-instance_method" title="ApplicationController#check_email_for_boarding_passes (method)">#check_email_for_boarding_passes</a></span>, <span class='object_link'><a href="ApplicationController.html#current_region-instance_method" title="ApplicationController#current_region (method)">#current_region</a></span>, <span class='object_link'><a href="ApplicationController.html#flyer-instance_method" title="ApplicationController#flyer (method)">#flyer</a></span>, <span class='object_link'><a href="ApplicationController.html#logged_in_user-instance_method" title="ApplicationController#logged_in_user (method)">#logged_in_user</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="SessionsHelper.html" title="SessionsHelper (module)">SessionsHelper</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="SessionsHelper.html#current_user-instance_method" title="SessionsHelper#current_user (method)">#current_user</a></span>, <span class='object_link'><a href="SessionsHelper.html#current_user=-instance_method" title="SessionsHelper#current_user= (method)">#current_user=</a></span>, <span class='object_link'><a href="SessionsHelper.html#log_in-instance_method" title="SessionsHelper#log_in (method)">#log_in</a></span>, <span class='object_link'><a href="SessionsHelper.html#log_out-instance_method" title="SessionsHelper#log_out (method)">#log_out</a></span>, <span class='object_link'><a href="SessionsHelper.html#logged_in%3F-instance_method" title="SessionsHelper#logged_in? (method)">#logged_in?</a></span></p>

  

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="create-instance_method">
  
    #<strong>create</strong>  &#x21d2; <tt>nil</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Creates a new <span class='object_link'><a href="Airport.html" title="Airport (class)">Airport</a></span>.</p>

<p>This action can only be performed by a verified user.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>nil</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/airports_controller.rb', line 223</span>

<span class='kw'>def</span> <span class='id identifier rubyid_create'>create</span>
  <span class='ivar'>@airport</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Airport.html" title="Airport (class)">Airport</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_airport_params'>airport_params</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='ivar'>@airport</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>
    <span class='ivar'>@airport</span><span class='period'>.</span><span class='id identifier rubyid_coordinates'>coordinates</span> <span class='comment'># Look up coordinates for new airport
</span>    <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:success</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Successfully added </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:airport</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:iata_code</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>if</span> <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:form_location</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_form_location'>form_location</span> <span class='op'>=</span> <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:form_location</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:form_location</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>nil</span>
      <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_form_location'>form_location</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='ivar'>@airport</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:form_location</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_render'>render</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>flights/new_undefined_airport</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_render'>render</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>new</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="destroy-instance_method">
  
    #<strong>destroy</strong>  &#x21d2; <tt>nil</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Deletes an existing <span class='object_link'><a href="Airport.html" title="Airport (class)">Airport</a></span>.</p>

<p>This action can only be performed by a verified user.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>nil</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


277
278
279
280
281
282
283
284
285
286
287
288
289
290
291</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/airports_controller.rb', line 277</span>

<span class='kw'>def</span> <span class='id identifier rubyid_destroy'>destroy</span>
  <span class='ivar'>@flights</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Flight.html" title="Flight (class)">Flight</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>origin_airport_id = :airport_id OR destination_airport_id = :airport_id</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='symbol'>:airport_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='ivar'>@flights</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span>
    <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:error</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>This airport still has flights and could not be deleted. Please delete all of this airportʼs flights first.</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_airport_path'>airport_path</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='kw'>if</span> <span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Airport.html" title="Airport (class)">Airport</a></span></span><span class='period'>.</span><span class='id identifier rubyid_exists?'>exists?</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='const'><span class='object_link'><a href="Airport.html" title="Airport (class)">Airport</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span>
    <span class='kw'>else</span>
      <span class='const'><span class='object_link'><a href="Airport.html" title="Airport (class)">Airport</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:iata_code</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_destroy'>destroy</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:success</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Airport destroyed.</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_airports_path'>airports_path</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="edit-instance_method">
  
    #<strong>edit</strong>  &#x21d2; <tt>nil</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Shows a form to edit an existing <span class='object_link'><a href="Airport.html" title="Airport (class)">Airport</a></span>.</p>

<p>This action can only be performed by a verified user.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>nil</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


249
250
251
252
253
254
255</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/airports_controller.rb', line 249</span>

<span class='kw'>def</span> <span class='id identifier rubyid_edit'>edit</span>
  <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:form_location</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@airport</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Airport.html" title="Airport (class)">Airport</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_add_breadcrumb'>add_breadcrumb</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Airports</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_airports_path'>airports_path</span>
  <span class='id identifier rubyid_add_breadcrumb'>add_breadcrumb</span> <span class='ivar'>@airport</span><span class='period'>.</span><span class='id identifier rubyid_iata_code'>iata_code</span><span class='comma'>,</span> <span class='id identifier rubyid_airport_path'>airport_path</span><span class='lparen'>(</span><span class='ivar'>@airport</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_add_breadcrumb'>add_breadcrumb</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Edit Airport</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_edit_airport_path'>edit_airport_path</span><span class='lparen'>(</span><span class='ivar'>@airport</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="index-instance_method">
  
    #<strong>index</strong>  &#x21d2; <tt>nil</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Shows a table of all <span class='object_link'><a href="Airport.html" title="Airport (class)">Airports</a></span> visited.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>nil</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/airports_controller.rb', line 9</span>

<span class='kw'>def</span> <span class='id identifier rubyid_index'>index</span>
  <span class='id identifier rubyid_add_breadcrumb'>add_breadcrumb</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Airports</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_airports_path'>airports_path</span>
  <span class='id identifier rubyid_add_admin_action'>add_admin_action</span> <span class='id identifier rubyid_view_context'>view_context</span><span class='period'>.</span><span class='id identifier rubyid_link_to'>link_to</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Add New Airport</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_new_airport_path'>new_airport_path</span><span class='rparen'>)</span>
  <span class='ivar'>@title</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Airports</span><span class='tstring_end'>&quot;</span></span>
  <span class='ivar'>@meta_description</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Maps and lists of airports Paul Bogard has visited, and how often heʼs visited them.</span><span class='tstring_end'>&quot;</span></span>
  <span class='ivar'>@flights</span> <span class='op'>=</span> <span class='id identifier rubyid_flyer'>flyer</span><span class='period'>.</span><span class='id identifier rubyid_flights'>flights</span><span class='lparen'>(</span><span class='id identifier rubyid_current_user'>current_user</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_includes'>includes</span><span class='lparen'>(</span><span class='symbol'>:origin_airport</span><span class='comma'>,</span> <span class='symbol'>:destination_airport</span><span class='rparen'>)</span>
  <span class='ivar'>@airports</span> <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  
  <span class='kw'>if</span> <span class='ivar'>@flights</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span>
    
    <span class='ivar'>@airports</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Airport.html" title="Airport (class)">Airport</a></span></span><span class='period'>.</span><span class='id identifier rubyid_visit_count'><span class='object_link'><a href="Airport.html#visit_count-class_method" title="Airport.visit_count (method)">visit_count</a></span></span><span class='lparen'>(</span><span class='ivar'>@flights</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_used_airport_codes'>used_airport_codes</span> <span class='op'>=</span> <span class='ivar'>@airports</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_a'>a</span><span class='op'>|</span> <span class='id identifier rubyid_a'>a</span><span class='lbracket'>[</span><span class='symbol'>:iata_code</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_uniq'>uniq</span><span class='period'>.</span><span class='id identifier rubyid_compact'>compact</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_logged_in?'>logged_in?</span>
      <span class='ivar'>@airports_with_no_flights</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Airport.html" title="Airport (class)">Airport</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='period'>.</span><span class='id identifier rubyid_not'>not</span><span class='lparen'>(</span><span class='label'>iata_code:</span> <span class='id identifier rubyid_used_airport_codes'>used_airport_codes</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='symbol'>:city</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  
    <span class='comment'># Sort route table:
</span>    
    <span class='id identifier rubyid_sort_params'>sort_params</span> <span class='op'>=</span> <span class='id identifier rubyid_sort_parse'>sort_parse</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:sort</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='qwords_beg'>%w(</span><span class='tstring_content'>visits</span><span class='words_sep'> </span><span class='tstring_content'>country</span><span class='words_sep'> </span><span class='tstring_content'>city</span><span class='words_sep'> </span><span class='tstring_content'>code</span><span class='words_sep'>)</span><span class='comma'>,</span> <span class='symbol'>:desc</span><span class='rparen'>)</span>
    <span class='ivar'>@sort_cat</span>   <span class='op'>=</span> <span class='id identifier rubyid_sort_params'>sort_params</span><span class='lbracket'>[</span><span class='symbol'>:category</span><span class='rbracket'>]</span>
    <span class='ivar'>@sort_dir</span>   <span class='op'>=</span> <span class='id identifier rubyid_sort_params'>sort_params</span><span class='lbracket'>[</span><span class='symbol'>:direction</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_sort_mult'>sort_mult</span>   <span class='op'>=</span> <span class='lparen'>(</span><span class='ivar'>@sort_dir</span> <span class='op'>==</span> <span class='symbol'>:asc</span> <span class='op'>?</span> <span class='int'>1</span> <span class='op'>:</span> <span class='op'>-</span><span class='int'>1</span><span class='rparen'>)</span>
    
    <span class='kw'>case</span> <span class='ivar'>@sort_cat</span>
    <span class='kw'>when</span> <span class='symbol'>:country</span>
      <span class='kw'>if</span> <span class='ivar'>@sort_dir</span> <span class='op'>==</span> <span class='symbol'>:asc</span>
        <span class='ivar'>@airports</span> <span class='op'>=</span> <span class='ivar'>@airports</span><span class='period'>.</span><span class='id identifier rubyid_sort_by'>sort_by</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_airport'>airport</span><span class='op'>|</span> <span class='lbracket'>[</span><span class='id identifier rubyid_airport'>airport</span><span class='lbracket'>[</span><span class='symbol'>:country</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_airport'>airport</span><span class='lbracket'>[</span><span class='symbol'>:city</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
      <span class='kw'>else</span>
        <span class='ivar'>@airports</span> <span class='op'>=</span> <span class='ivar'>@airports</span><span class='period'>.</span><span class='id identifier rubyid_sort'>sort</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_a'>a</span><span class='comma'>,</span> <span class='id identifier rubyid_b'>b</span><span class='op'>|</span> <span class='lbracket'>[</span><span class='id identifier rubyid_b'>b</span><span class='lbracket'>[</span><span class='symbol'>:country</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_a'>a</span><span class='lbracket'>[</span><span class='symbol'>:city</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='op'>&lt;=&gt;</span> <span class='lbracket'>[</span><span class='id identifier rubyid_a'>a</span><span class='lbracket'>[</span><span class='symbol'>:country</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_b'>b</span><span class='lbracket'>[</span><span class='symbol'>:city</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
      <span class='kw'>end</span>
    <span class='kw'>when</span> <span class='symbol'>:city</span>
      <span class='ivar'>@airports</span> <span class='op'>=</span> <span class='ivar'>@airports</span><span class='period'>.</span><span class='id identifier rubyid_sort_by'>sort_by</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_airport'>airport</span><span class='op'>|</span> <span class='id identifier rubyid_airport'>airport</span><span class='lbracket'>[</span><span class='symbol'>:city</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
      <span class='ivar'>@airports</span><span class='period'>.</span><span class='id identifier rubyid_reverse!'>reverse!</span> <span class='kw'>if</span> <span class='ivar'>@sort_dir</span> <span class='op'>==</span> <span class='symbol'>:desc</span>
    <span class='kw'>when</span> <span class='symbol'>:code</span>
      <span class='ivar'>@airports</span> <span class='op'>=</span> <span class='ivar'>@airports</span><span class='period'>.</span><span class='id identifier rubyid_sort_by'>sort_by</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_airport'>airport</span><span class='op'>|</span> <span class='id identifier rubyid_airport'>airport</span><span class='lbracket'>[</span><span class='symbol'>:iata_code</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
      <span class='ivar'>@airports</span><span class='period'>.</span><span class='id identifier rubyid_reverse!'>reverse!</span> <span class='kw'>if</span> <span class='ivar'>@sort_dir</span> <span class='op'>==</span> <span class='symbol'>:desc</span>
    <span class='kw'>when</span> <span class='symbol'>:visits</span>
      <span class='ivar'>@airports</span> <span class='op'>=</span> <span class='ivar'>@airports</span><span class='period'>.</span><span class='id identifier rubyid_sort_by'>sort_by</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_airport'>airport</span><span class='op'>|</span> <span class='lbracket'>[</span><span class='id identifier rubyid_sort_mult'>sort_mult</span><span class='op'>*</span><span class='id identifier rubyid_airport'>airport</span><span class='lbracket'>[</span><span class='symbol'>:visit_count</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_airport'>airport</span><span class='lbracket'>[</span><span class='symbol'>:city</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
    <span class='kw'>end</span>
    
    <span class='comment'># Create maps:
</span>    <span class='ivar'>@region</span> <span class='op'>=</span> <span class='id identifier rubyid_current_region'>current_region</span><span class='lparen'>(</span><span class='label'>default:</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='ivar'>@airports_map</span>  <span class='op'>=</span> <span class='const'><span class='object_link'><a href="AirportsMap.html" title="AirportsMap (class)">AirportsMap</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="AirportsMap.html#initialize-instance_method" title="AirportsMap#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="Airport.html" title="Airport (class)">Airport</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>iata_code:</span> <span class='id identifier rubyid_used_airport_codes'>used_airport_codes</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='label'>region:</span> <span class='ivar'>@region</span><span class='rparen'>)</span>
    <span class='ivar'>@frequency_map</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="AirportFrequencyMap.html" title="AirportFrequencyMap (class)">AirportFrequencyMap</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="AirportFrequencyMap.html#initialize-instance_method" title="AirportFrequencyMap#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='ivar'>@flights</span><span class='comma'>,</span> <span class='label'>region:</span> <span class='ivar'>@region</span><span class='rparen'>)</span>
    
  <span class='kw'>end</span>
  
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="new-instance_method">
  
    #<strong>new</strong>  &#x21d2; <tt>nil</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Shows a form to add an <span class='object_link'><a href="Airport.html" title="Airport (class)">Airport</a></span>.</p>

<p>This action can only be performed by a verified user.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>nil</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


210
211
212
213
214
215
216</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/airports_controller.rb', line 210</span>

<span class='kw'>def</span> <span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:form_location</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@title</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>New Airport</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_add_breadcrumb'>add_breadcrumb</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Airports</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_airports_path'>airports_path</span>
  <span class='id identifier rubyid_add_breadcrumb'>add_breadcrumb</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>New Airport</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_new_airport_path'>new_airport_path</span>
  <span class='ivar'>@airport</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Airport.html" title="Airport (class)">Airport</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="show-instance_method">
  
    #<strong>show</strong>  &#x21d2; <tt>nil</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Shows details for a particular <span class='object_link'><a href="Airport.html" title="Airport (class)">Airport</a></span> and data for all <span class='object_link'><a href="Flight.html" title="Flight (class)">Flights</a></span>
which use it.</p>

<p><span class='object_link'><a href="Airport.html" title="Airport (class)">Airport</a></span> details:</p>
<ul><li>
<p>city (and name if needed for disambiguation)</p>
</li><li>
<p>latitude and longitude</p>
</li><li>
<p>IATA and ICAO codes</p>
</li><li>
<p>a <a href="https://www.pbogard.com/projects/terminal-silhouettes" target="_parent" title="terminal silhouette">terminal silhouette</a></p>
</li></ul>

<p><span class='object_link'><a href="Flight.html" title="Flight (class)">Flight</a></span> data:</p>
<ul><li>
<p>a table of <span class='object_link'><a href="Flight.html" title="Flight (class)">Flights</a></span> with a <span class='object_link'><a href="FlightsMap.html" title="FlightsMap (class)">FlightsMap</a></span></p>
</li><li>
<p>the total distance flown</p>
</li><li>
<p>a table of <span class='object_link'><a href="TripsController.html#show_section-instance_method" title="TripsController#show_section (method)">trip sections</a></span> with a <span class='object_link'><a href="FlightsMap.html" title="FlightsMap (class)">FlightsMap</a></span>
of all <span class='object_link'><a href="Flight.html" title="Flight (class)">Flights</a></span> in those sections</p>
</li><li>
<p>a table of <span class='object_link'><a href="Trip.html" title="Trip (class)">Trips</a></span> with a <span class='object_link'><a href="FlightsMap.html" title="FlightsMap (class)">FlightsMap</a></span> of all <span class='object_link'><a href="Flight.html" title="Flight (class)">Flights</a></span> in
those trips</p>
</li><li>
<p>a table of <span class='object_link'><a href="Airline.html" title="Airline (class)">Airlines</a></span></p>
</li><li>
<p>a table of <span class='object_link'><a href="AirlinesController.html#show_operator-instance_method" title="AirlinesController#show_operator (method)">operators</a></span></p>
</li><li>
<p>a table of <span class='object_link'><a href="AircraftFamily.html" title="AircraftFamily (class)">AircraftFamilies</a></span></p>
</li><li>
<p>a table of <span class='object_link'><a href="FlightsController.html#show_class-instance_method" title="FlightsController#show_class (method)">classes</a></span></p>
</li><li>
<p>the longest and shortest <span class='object_link'><a href="Flight.html" title="Flight (class)">Flight</a></span></p>
</li></ul>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>nil</tt>)</span>
      
      
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="https://www.pbogard.com/projects/terminal-silhouettes" target="_parent" title="Terminal Silhouettes">Terminal Silhouettes</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/airports_controller.rb', line 80</span>

<span class='kw'>def</span> <span class='id identifier rubyid_show'>show</span>
  <span class='ivar'>@logo_used</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>&gt;</span> <span class='int'>0</span>
    <span class='ivar'>@airport</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Airport.html" title="Airport (class)">Airport</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='ivar'>@airport</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Airport.html" title="Airport (class)">Airport</a></span></span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:iata_code</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>RecordNotFound</span> <span class='kw'>if</span> <span class='lparen'>(</span><span class='ivar'>@airport</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  
  <span class='id identifier rubyid_flyer_flights'>flyer_flights</span> <span class='op'>=</span> <span class='id identifier rubyid_flyer'>flyer</span><span class='period'>.</span><span class='id identifier rubyid_flights'>flights</span><span class='lparen'>(</span><span class='id identifier rubyid_current_user'>current_user</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_includes'>includes</span><span class='lparen'>(</span><span class='symbol'>:airline</span><span class='comma'>,</span> <span class='symbol'>:origin_airport</span><span class='comma'>,</span> <span class='symbol'>:destination_airport</span><span class='comma'>,</span> <span class='symbol'>:trip</span><span class='rparen'>)</span>
  <span class='ivar'>@flights</span> <span class='op'>=</span> <span class='id identifier rubyid_flyer_flights'>flyer_flights</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>origin_airport_id = ? OR destination_airport_id = ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='ivar'>@airport</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='ivar'>@airport</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
  
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>RecordNotFound</span> <span class='kw'>if</span> <span class='lparen'>(</span><span class='ivar'>@flights</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>==</span> <span class='int'>0</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_logged_in?'>logged_in?</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_trip_array'>trip_array</span> <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='ivar'>@sections</span> <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_section_where_array'>section_where_array</span> <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_pair_totals'>pair_totals</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='int'>0</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_pair_cities'>pair_cities</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_pair_countries'>pair_countries</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_pair_distances'>pair_distances</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='ivar'>@direct_flight_airports</span> <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_prev_trip_id'>prev_trip_id</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_prev_section_id'>prev_section_id</span> <span class='op'>=</span> <span class='kw'>nil</span>
  
  <span class='ivar'>@total_distance</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Route.html" title="Route (class)">Route</a></span></span><span class='period'>.</span><span class='id identifier rubyid_total_distance'><span class='object_link'><a href="Route.html#total_distance-class_method" title="Route.total_distance (method)">total_distance</a></span></span><span class='lparen'>(</span><span class='ivar'>@flights</span><span class='rparen'>)</span>
  
  <span class='comment'># Calculate distances to direct flight airports:
</span>  <span class='id identifier rubyid_direct_flight_airports'>direct_flight_airports</span> <span class='op'>=</span> <span class='ivar'>@flights</span><span class='period'>.</span><span class='id identifier rubyid_pluck'>pluck</span><span class='lparen'>(</span><span class='symbol'>:origin_airport_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_concat'>concat</span><span class='lparen'>(</span><span class='ivar'>@flights</span><span class='period'>.</span><span class='id identifier rubyid_pluck'>pluck</span><span class='lparen'>(</span><span class='symbol'>:destination_airport_id</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_uniq'>uniq</span>
  <span class='id identifier rubyid_route_hash'>route_hash</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='rparen'>)</span>
  <span class='const'><span class='object_link'><a href="Route.html" title="Route (class)">Route</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find_by_sql'>find_by_sql</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT routes.distance_mi, airports1.iata_code AS iata1, airports2.iata_code AS iata2 FROM routes JOIN airports AS airports1 ON airports1.id = routes.airport1_id JOIN airports AS airports2 ON airports2.id = routes.airport2_id WHERE routes.airport1_id = ? OR routes.airport2_id = ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='ivar'>@airport</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='ivar'>@airport</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span> <span class='id identifier rubyid_route_hash'>route_hash</span><span class='lbracket'>[</span><span class='lbracket'>[</span><span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_iata1'>iata1</span><span class='comma'>,</span><span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_iata2'>iata2</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_distance_mi'>distance_mi</span> <span class='rbrace'>}</span>

  <span class='ivar'>@flights</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_flight'>flight</span><span class='op'>|</span>
    <span class='id identifier rubyid_trip_array'>trip_array</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='id identifier rubyid_flight'>flight</span><span class='period'>.</span><span class='id identifier rubyid_trip_id'>trip_id</span><span class='rparen'>)</span>
    <span class='kw'>unless</span> <span class='lparen'>(</span><span class='id identifier rubyid_flight'>flight</span><span class='period'>.</span><span class='id identifier rubyid_trip_id'>trip_id</span> <span class='op'>==</span> <span class='id identifier rubyid_prev_trip_id'>prev_trip_id</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_flight'>flight</span><span class='period'>.</span><span class='id identifier rubyid_trip_section'>trip_section</span> <span class='op'>==</span> <span class='id identifier rubyid_prev_section_id'>prev_section_id</span><span class='rparen'>)</span>
      <span class='ivar'>@sections</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span> <span class='lbrace'>{</span><span class='symbol'>:trip_id</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_flight'>flight</span><span class='period'>.</span><span class='id identifier rubyid_trip_id'>trip_id</span><span class='comma'>,</span> <span class='symbol'>:trip_name</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_flight'>flight</span><span class='period'>.</span><span class='id identifier rubyid_trip'>trip</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='symbol'>:trip_section</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_flight'>flight</span><span class='period'>.</span><span class='id identifier rubyid_trip_section'>trip_section</span><span class='comma'>,</span> <span class='symbol'>:departure</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_flight'>flight</span><span class='period'>.</span><span class='id identifier rubyid_departure_date'>departure_date</span><span class='rbrace'>}</span> <span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_prev_trip_id'>prev_trip_id</span> <span class='op'>=</span> <span class='id identifier rubyid_flight'>flight</span><span class='period'>.</span><span class='id identifier rubyid_trip_id'>trip_id</span>
    <span class='id identifier rubyid_prev_section_id'>prev_section_id</span> <span class='op'>=</span> <span class='id identifier rubyid_flight'>flight</span><span class='period'>.</span><span class='id identifier rubyid_trip_section'>trip_section</span>
    <span class='id identifier rubyid_section_where_array'>section_where_array</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>(trip_id = </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_flight'>flight</span><span class='period'>.</span><span class='id identifier rubyid_trip_id'>trip_id</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='embexpr_end'>}</span><span class='tstring_content'> AND trip_section = </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_flight'>flight</span><span class='period'>.</span><span class='id identifier rubyid_trip_section'>trip_section</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

    <span class='comment'># Create hash of the other airports on flights to/from this airport and their counts
</span>    <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_flight'>flight</span><span class='period'>.</span><span class='id identifier rubyid_origin_airport'>origin_airport</span><span class='period'>.</span><span class='id identifier rubyid_iata_code'>iata_code</span> <span class='op'>==</span> <span class='ivar'>@airport</span><span class='period'>.</span><span class='id identifier rubyid_iata_code'>iata_code</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_pair_totals'>pair_totals</span><span class='lbracket'>[</span><span class='id identifier rubyid_flight'>flight</span><span class='period'>.</span><span class='id identifier rubyid_destination_airport'>destination_airport</span><span class='period'>.</span><span class='id identifier rubyid_iata_code'>iata_code</span><span class='rbracket'>]</span> <span class='op'>+=</span> <span class='int'>1</span>
      <span class='id identifier rubyid_pair_cities'>pair_cities</span><span class='lbracket'>[</span><span class='id identifier rubyid_flight'>flight</span><span class='period'>.</span><span class='id identifier rubyid_destination_airport'>destination_airport</span><span class='period'>.</span><span class='id identifier rubyid_iata_code'>iata_code</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_flight'>flight</span><span class='period'>.</span><span class='id identifier rubyid_destination_airport'>destination_airport</span><span class='period'>.</span><span class='id identifier rubyid_city'>city</span>
      <span class='id identifier rubyid_pair_countries'>pair_countries</span><span class='lbracket'>[</span><span class='id identifier rubyid_flight'>flight</span><span class='period'>.</span><span class='id identifier rubyid_destination_airport'>destination_airport</span><span class='period'>.</span><span class='id identifier rubyid_iata_code'>iata_code</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_flight'>flight</span><span class='period'>.</span><span class='id identifier rubyid_destination_airport'>destination_airport</span><span class='period'>.</span><span class='id identifier rubyid_country'>country</span>
      <span class='id identifier rubyid_pair_distances'>pair_distances</span><span class='lbracket'>[</span><span class='id identifier rubyid_flight'>flight</span><span class='period'>.</span><span class='id identifier rubyid_destination_airport'>destination_airport</span><span class='period'>.</span><span class='id identifier rubyid_iata_code'>iata_code</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_route_hash'>route_hash</span><span class='lbracket'>[</span><span class='lbracket'>[</span><span class='id identifier rubyid_flight'>flight</span><span class='period'>.</span><span class='id identifier rubyid_origin_airport'>origin_airport</span><span class='period'>.</span><span class='id identifier rubyid_iata_code'>iata_code</span><span class='comma'>,</span><span class='id identifier rubyid_flight'>flight</span><span class='period'>.</span><span class='id identifier rubyid_destination_airport'>destination_airport</span><span class='period'>.</span><span class='id identifier rubyid_iata_code'>iata_code</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_route_hash'>route_hash</span><span class='lbracket'>[</span><span class='lbracket'>[</span><span class='id identifier rubyid_flight'>flight</span><span class='period'>.</span><span class='id identifier rubyid_destination_airport'>destination_airport</span><span class='period'>.</span><span class='id identifier rubyid_iata_code'>iata_code</span><span class='comma'>,</span><span class='id identifier rubyid_flight'>flight</span><span class='period'>.</span><span class='id identifier rubyid_origin_airport'>origin_airport</span><span class='period'>.</span><span class='id identifier rubyid_iata_code'>iata_code</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_pair_totals'>pair_totals</span><span class='lbracket'>[</span><span class='id identifier rubyid_flight'>flight</span><span class='period'>.</span><span class='id identifier rubyid_origin_airport'>origin_airport</span><span class='period'>.</span><span class='id identifier rubyid_iata_code'>iata_code</span><span class='rbracket'>]</span> <span class='op'>+=</span> <span class='int'>1</span>
      <span class='id identifier rubyid_pair_cities'>pair_cities</span><span class='lbracket'>[</span><span class='id identifier rubyid_flight'>flight</span><span class='period'>.</span><span class='id identifier rubyid_origin_airport'>origin_airport</span><span class='period'>.</span><span class='id identifier rubyid_iata_code'>iata_code</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_flight'>flight</span><span class='period'>.</span><span class='id identifier rubyid_origin_airport'>origin_airport</span><span class='period'>.</span><span class='id identifier rubyid_city'>city</span>
      <span class='id identifier rubyid_pair_countries'>pair_countries</span><span class='lbracket'>[</span><span class='id identifier rubyid_flight'>flight</span><span class='period'>.</span><span class='id identifier rubyid_origin_airport'>origin_airport</span><span class='period'>.</span><span class='id identifier rubyid_iata_code'>iata_code</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_flight'>flight</span><span class='period'>.</span><span class='id identifier rubyid_origin_airport'>origin_airport</span><span class='period'>.</span><span class='id identifier rubyid_country'>country</span>
      <span class='id identifier rubyid_pair_distances'>pair_distances</span><span class='lbracket'>[</span><span class='id identifier rubyid_flight'>flight</span><span class='period'>.</span><span class='id identifier rubyid_origin_airport'>origin_airport</span><span class='period'>.</span><span class='id identifier rubyid_iata_code'>iata_code</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_route_hash'>route_hash</span><span class='lbracket'>[</span><span class='lbracket'>[</span><span class='id identifier rubyid_flight'>flight</span><span class='period'>.</span><span class='id identifier rubyid_origin_airport'>origin_airport</span><span class='period'>.</span><span class='id identifier rubyid_iata_code'>iata_code</span><span class='comma'>,</span><span class='id identifier rubyid_flight'>flight</span><span class='period'>.</span><span class='id identifier rubyid_destination_airport'>destination_airport</span><span class='period'>.</span><span class='id identifier rubyid_iata_code'>iata_code</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_route_hash'>route_hash</span><span class='lbracket'>[</span><span class='lbracket'>[</span><span class='id identifier rubyid_flight'>flight</span><span class='period'>.</span><span class='id identifier rubyid_destination_airport'>destination_airport</span><span class='period'>.</span><span class='id identifier rubyid_iata_code'>iata_code</span><span class='comma'>,</span><span class='id identifier rubyid_flight'>flight</span><span class='period'>.</span><span class='id identifier rubyid_origin_airport'>origin_airport</span><span class='period'>.</span><span class='id identifier rubyid_iata_code'>iata_code</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  
  <span class='id identifier rubyid_trip_array'>trip_array</span> <span class='op'>=</span> <span class='id identifier rubyid_trip_array'>trip_array</span><span class='period'>.</span><span class='id identifier rubyid_uniq'>uniq</span><span class='period'>.</span><span class='id identifier rubyid_sort'>sort</span>
  <span class='ivar'>@sections</span><span class='period'>.</span><span class='id identifier rubyid_uniq!'>uniq!</span>

  <span class='ivar'>@trips</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Flight.html" title="Flight (class)">Flight</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find_by_sql'>find_by_sql</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SELECT flights.trip_id AS id, MIN(flights.departure_date) AS departure_date, name, hidden FROM flights INNER JOIN trips on trips.id = flights.trip_id WHERE flights.trip_id IN (?) GROUP BY flights.trip_id, name, hidden ORDER BY departure_date</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_trip_array'>trip_array</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  
  <span class='ivar'>@trips_using_airport_flights</span> <span class='op'>=</span> <span class='id identifier rubyid_flyer_flights'>flyer_flights</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>trip_id:</span> <span class='id identifier rubyid_trip_array'>trip_array</span><span class='rparen'>)</span>
  <span class='ivar'>@sections_using_airport_flights</span> <span class='op'>=</span> <span class='id identifier rubyid_flyer_flights'>flyer_flights</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='id identifier rubyid_section_where_array'>section_where_array</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> OR </span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>

  <span class='ivar'>@airport_frequency</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Airport.html" title="Airport (class)">Airport</a></span></span><span class='period'>.</span><span class='id identifier rubyid_frequency_hash'><span class='object_link'><a href="Airport.html#frequency_hash-class_method" title="Airport.frequency_hash (method)">frequency_hash</a></span></span><span class='lparen'>(</span><span class='ivar'>@flights</span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='ivar'>@airport</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span>
 
  <span class='ivar'>@pair_maximum</span> <span class='op'>=</span> <span class='id identifier rubyid_pair_totals'>pair_totals</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;</span> <span class='int'>0</span> <span class='op'>?</span> <span class='id identifier rubyid_pair_totals'>pair_totals</span><span class='period'>.</span><span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_max'>max</span> <span class='op'>:</span> <span class='int'>1</span>
 
  <span class='comment'># Create direct flight airport array sorted by count descending, city ascending:
</span>  <span class='id identifier rubyid_pair_totals'>pair_totals</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_airport'>airport</span><span class='comma'>,</span> <span class='id identifier rubyid_count'>count</span><span class='op'>|</span>
    <span class='ivar'>@direct_flight_airports</span> <span class='op'>&lt;&lt;</span> <span class='lbrace'>{</span><span class='symbol'>:iata_code</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_airport'>airport</span><span class='comma'>,</span> <span class='symbol'>:total_flights</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_count'>count</span><span class='comma'>,</span> <span class='symbol'>:city</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_pair_cities'>pair_cities</span><span class='lbracket'>[</span><span class='id identifier rubyid_airport'>airport</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='symbol'>:distance_mi</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_pair_distances'>pair_distances</span><span class='lbracket'>[</span><span class='id identifier rubyid_airport'>airport</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='symbol'>:country</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_pair_countries'>pair_countries</span><span class='lbracket'>[</span><span class='id identifier rubyid_airport'>airport</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>
  
  <span class='comment'># Find maxima for graph scaling:
</span>  <span class='kw'>if</span> <span class='ivar'>@flights</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>||</span> <span class='ivar'>@direct_flight_airports</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='ivar'>@flights_maximum</span> <span class='op'>=</span> <span class='int'>0</span>
    <span class='ivar'>@distance_maximum</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='kw'>else</span>
    <span class='ivar'>@flights_maximum</span> <span class='op'>=</span> <span class='ivar'>@direct_flight_airports</span><span class='period'>.</span><span class='id identifier rubyid_max_by'>max_by</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='id identifier rubyid_i'>i</span><span class='lbracket'>[</span><span class='symbol'>:total_flights</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='rbrace'>}</span><span class='lbracket'>[</span><span class='symbol'>:total_flights</span><span class='rbracket'>]</span>
    <span class='ivar'>@distance_maximum</span> <span class='op'>=</span> <span class='ivar'>@direct_flight_airports</span><span class='period'>.</span><span class='id identifier rubyid_max_by'>max_by</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span> <span class='id identifier rubyid_i'>i</span><span class='lbracket'>[</span><span class='symbol'>:distance_mi</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='rbrace'>}</span><span class='lbracket'>[</span><span class='symbol'>:distance_mi</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
  
  <span class='comment'># Sort city pair table:
</span>  <span class='id identifier rubyid_sort_params'>sort_params</span> <span class='op'>=</span> <span class='id identifier rubyid_sort_parse'>sort_parse</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:sort</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='qwords_beg'>%w(</span><span class='tstring_content'>flights</span><span class='words_sep'> </span><span class='tstring_content'>city</span><span class='words_sep'> </span><span class='tstring_content'>code</span><span class='words_sep'> </span><span class='tstring_content'>distance</span><span class='words_sep'>)</span><span class='comma'>,</span> <span class='symbol'>:desc</span><span class='rparen'>)</span>
  <span class='ivar'>@sort_cat</span>   <span class='op'>=</span> <span class='id identifier rubyid_sort_params'>sort_params</span><span class='lbracket'>[</span><span class='symbol'>:category</span><span class='rbracket'>]</span>
  <span class='ivar'>@sort_dir</span>   <span class='op'>=</span> <span class='id identifier rubyid_sort_params'>sort_params</span><span class='lbracket'>[</span><span class='symbol'>:direction</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_sort_mult'>sort_mult</span>   <span class='op'>=</span> <span class='lparen'>(</span><span class='ivar'>@sort_dir</span> <span class='op'>==</span> <span class='symbol'>:asc</span> <span class='op'>?</span> <span class='int'>1</span> <span class='op'>:</span> <span class='op'>-</span><span class='int'>1</span><span class='rparen'>)</span>
  
  <span class='kw'>case</span> <span class='ivar'>@sort_cat</span>
  <span class='kw'>when</span> <span class='symbol'>:city</span>
    <span class='ivar'>@direct_flight_airports</span> <span class='op'>=</span> <span class='ivar'>@direct_flight_airports</span><span class='period'>.</span><span class='id identifier rubyid_sort_by'>sort_by</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_value'>value</span><span class='op'>|</span> <span class='id identifier rubyid_value'>value</span><span class='lbracket'>[</span><span class='symbol'>:city</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
    <span class='ivar'>@direct_flight_airports</span><span class='period'>.</span><span class='id identifier rubyid_reverse!'>reverse!</span> <span class='kw'>if</span> <span class='ivar'>@sort_dir</span> <span class='op'>==</span> <span class='symbol'>:desc</span>
  <span class='kw'>when</span> <span class='symbol'>:code</span>
    <span class='ivar'>@direct_flight_airports</span> <span class='op'>=</span> <span class='ivar'>@direct_flight_airports</span><span class='period'>.</span><span class='id identifier rubyid_sort_by'>sort_by</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_value'>value</span><span class='op'>|</span> <span class='id identifier rubyid_value'>value</span><span class='lbracket'>[</span><span class='symbol'>:iata_code</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
    <span class='ivar'>@direct_flight_airports</span><span class='period'>.</span><span class='id identifier rubyid_reverse!'>reverse!</span> <span class='kw'>if</span> <span class='ivar'>@sort_dir</span> <span class='op'>==</span> <span class='symbol'>:desc</span>
  <span class='kw'>when</span> <span class='symbol'>:flights</span>
    <span class='ivar'>@direct_flight_airports</span> <span class='op'>=</span> <span class='ivar'>@direct_flight_airports</span><span class='period'>.</span><span class='id identifier rubyid_sort_by'>sort_by</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_value'>value</span><span class='op'>|</span> <span class='lbracket'>[</span><span class='id identifier rubyid_sort_mult'>sort_mult</span><span class='op'>*</span><span class='id identifier rubyid_value'>value</span><span class='lbracket'>[</span><span class='symbol'>:total_flights</span><span class='rbracket'>]</span><span class='comma'>,</span><span class='id identifier rubyid_value'>value</span><span class='lbracket'>[</span><span class='symbol'>:city</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
  <span class='kw'>when</span> <span class='symbol'>:distance</span>
    <span class='ivar'>@direct_flight_airports</span> <span class='op'>=</span> <span class='ivar'>@direct_flight_airports</span><span class='period'>.</span><span class='id identifier rubyid_sort_by'>sort_by</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_value'>value</span><span class='op'>|</span> <span class='lbracket'>[</span><span class='id identifier rubyid_sort_mult'>sort_mult</span><span class='op'>*</span><span class='id identifier rubyid_value'>value</span><span class='lbracket'>[</span><span class='symbol'>:distance_mi</span><span class='rbracket'>]</span><span class='comma'>,</span><span class='id identifier rubyid_value'>value</span><span class='lbracket'>[</span><span class='symbol'>:city</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>
  
  <span class='comment'># Create comparitive lists of airlines, aircraft, and classes:
</span>  <span class='ivar'>@airlines</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Airline.html" title="Airline (class)">Airline</a></span></span><span class='period'>.</span><span class='id identifier rubyid_flight_count'><span class='object_link'><a href="Airline.html#flight_count-class_method" title="Airline.flight_count (method)">flight_count</a></span></span><span class='lparen'>(</span><span class='ivar'>@flights</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='symbol'>:airline</span><span class='rparen'>)</span>
  <span class='ivar'>@operators</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Airline.html" title="Airline (class)">Airline</a></span></span><span class='period'>.</span><span class='id identifier rubyid_flight_count'><span class='object_link'><a href="Airline.html#flight_count-class_method" title="Airline.flight_count (method)">flight_count</a></span></span><span class='lparen'>(</span><span class='ivar'>@flights</span><span class='comma'>,</span> <span class='label'>type:</span> <span class='symbol'>:operator</span><span class='rparen'>)</span>
  <span class='ivar'>@aircraft_families</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="AircraftFamily.html" title="AircraftFamily (class)">AircraftFamily</a></span></span><span class='period'>.</span><span class='id identifier rubyid_flight_count'><span class='object_link'><a href="AircraftFamily.html#flight_count-class_method" title="AircraftFamily.flight_count (method)">flight_count</a></span></span><span class='lparen'>(</span><span class='ivar'>@flights</span><span class='rparen'>)</span>
  <span class='ivar'>@classes</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="TravelClass.html" title="TravelClass (module)">TravelClass</a></span></span><span class='period'>.</span><span class='id identifier rubyid_flight_count'><span class='object_link'><a href="TravelClass.html#flight_count-class_method" title="TravelClass.flight_count (method)">flight_count</a></span></span><span class='lparen'>(</span><span class='ivar'>@flights</span><span class='rparen'>)</span>
  
  <span class='comment'># Create maps:
</span>  <span class='ivar'>@region</span> <span class='op'>=</span> <span class='id identifier rubyid_current_region'>current_region</span><span class='lparen'>(</span><span class='label'>default:</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='ivar'>@airport_map</span>  <span class='op'>=</span> <span class='const'><span class='object_link'><a href="FlightsMap.html" title="FlightsMap (class)">FlightsMap</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="FlightsMap.html#initialize-instance_method" title="FlightsMap#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='ivar'>@flights</span><span class='comma'>,</span> <span class='label'>highlighted_airports:</span> <span class='lbracket'>[</span><span class='ivar'>@airport</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>region:</span> <span class='ivar'>@region</span><span class='rparen'>)</span>
  <span class='ivar'>@sections_map</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="FlightsMap.html" title="FlightsMap (class)">FlightsMap</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="FlightsMap.html#initialize-instance_method" title="FlightsMap#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='ivar'>@sections_using_airport_flights</span><span class='comma'>,</span> <span class='label'>highlighted_airports:</span> <span class='lbracket'>[</span><span class='ivar'>@airport</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>region:</span> <span class='ivar'>@region</span><span class='rparen'>)</span>
  <span class='ivar'>@trips_map</span>    <span class='op'>=</span> <span class='const'><span class='object_link'><a href="FlightsMap.html" title="FlightsMap (class)">FlightsMap</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="FlightsMap.html#initialize-instance_method" title="FlightsMap#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='ivar'>@trips_using_airport_flights</span><span class='comma'>,</span> <span class='label'>highlighted_airports:</span> <span class='lbracket'>[</span><span class='ivar'>@airport</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>region:</span> <span class='ivar'>@region</span><span class='rparen'>)</span>
  
  <span class='ivar'>@title</span> <span class='op'>=</span> <span class='ivar'>@airport</span><span class='period'>.</span><span class='id identifier rubyid_iata_code'>iata_code</span>
  <span class='ivar'>@meta_description</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Maps and lists of Paul Bogardʼs flights through </span><span class='embexpr_beg'>#{</span><span class='ivar'>@airport</span><span class='period'>.</span><span class='id identifier rubyid_iata_code'>iata_code</span><span class='embexpr_end'>}</span><span class='tstring_content'> – </span><span class='embexpr_beg'>#{</span><span class='ivar'>@airport</span><span class='period'>.</span><span class='id identifier rubyid_city'>city</span><span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span>
  
  <span class='id identifier rubyid_add_breadcrumb'>add_breadcrumb</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Airports</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_airports_path'>airports_path</span>
  <span class='id identifier rubyid_add_breadcrumb'>add_breadcrumb</span> <span class='ivar'>@title</span><span class='comma'>,</span> <span class='id identifier rubyid_airport_path'>airport_path</span><span class='lparen'>(</span><span class='ivar'>@airport</span><span class='period'>.</span><span class='id identifier rubyid_iata_code'>iata_code</span><span class='rparen'>)</span>
  
  <span class='id identifier rubyid_add_admin_action'>add_admin_action</span> <span class='id identifier rubyid_view_context'>view_context</span><span class='period'>.</span><span class='id identifier rubyid_link_to'>link_to</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Delete Airport</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='ivar'>@airport</span><span class='comma'>,</span> <span class='label'>method:</span> <span class='symbol'>:delete</span><span class='comma'>,</span> <span class='label'>data:</span> <span class='lbrace'>{</span><span class='label'>confirm:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Are you sure you want to delete </span><span class='embexpr_beg'>#{</span><span class='ivar'>@airport</span><span class='period'>.</span><span class='id identifier rubyid_iata_code'>iata_code</span><span class='embexpr_end'>}</span><span class='tstring_content'>?</span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='symbol'>:class</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>warning</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='ivar'>@flights</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>==</span> <span class='int'>0</span>
  <span class='id identifier rubyid_add_admin_action'>add_admin_action</span> <span class='id identifier rubyid_view_context'>view_context</span><span class='period'>.</span><span class='id identifier rubyid_link_to'>link_to</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Edit Airport</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_edit_airport_path'>edit_airport_path</span><span class='lparen'>(</span><span class='ivar'>@airport</span><span class='rparen'>)</span><span class='rparen'>)</span>
  
<span class='kw'>rescue</span> <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>RecordNotFound</span>
  <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:warning</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>We couldnʼt find an airport with an ID of </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>. Instead, weʼll give you a list of airports.</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_airports_path'>airports_path</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update-instance_method">
  
    #<strong>update</strong>  &#x21d2; <tt>nil</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Updates an existing <span class='object_link'><a href="Airport.html" title="Airport (class)">Airport</a></span>.</p>

<p>This action can only be performed by a verified user.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>nil</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


262
263
264
265
266
267
268
269
270</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/airports_controller.rb', line 262</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update'>update</span>
  <span class='ivar'>@airport</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Airport.html" title="Airport (class)">Airport</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='ivar'>@airport</span><span class='period'>.</span><span class='id identifier rubyid_update_attributes'>update_attributes</span><span class='lparen'>(</span><span class='id identifier rubyid_airport_params'>airport_params</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:success</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Successfully updated airport.</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='ivar'>@airport</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_render'>render</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>edit</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Mon Jun  3 21:10:52 2019 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.19 (ruby-2.3.1).
</div>

    </div>
  </body>
</html>